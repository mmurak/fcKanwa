<html>
	<head>
		<title>講談社 大字典 7訂新装版（1963）検索</title>
		<link rel="shortcut icon" href="kiwi-bird.png">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" >
		<meta name="viewport" content="width=device-width,initial-scale=1.0">
		<style>
body {
	font-size: 14px;
}

@media screen and (max-width: 768px) {
body {
	font-size: 24px;
}
input[type="textfield"] {
	font-size: 24px;
}
button{
	font-size: 24px;
}
		</style>
	</head>
	<body>
<h3>講談社 大字典 7訂新装版（1963）</h3>
		<table border="0">
			<tr>
				<td><input type="textfield" id="FCentry" placeholder="四角号碼を半角数字で入力" autocomplete="off"/></td>
				<td><button onclick="fcSearch()">四角号碼検索</button></td>
			</tr>
			<tr>
				<td><input type="textfield" id="PageEntry" placeholder="本文ページ番号を半角数字を入力" autocomplete="off"/></td>
				<td><button onclick="directOpen()">本文ページを開く</button></td>
			</tr>
		</table>

<p><span style="font-size: 75%">※ 使用するには、国会図書館デジタルコレクションの「個人向けデジタル化資料送信サービス」にログインしておく必要があります。</span></p>

<script src="./koudanshaDaijitenInfo.js"></script>

<script>
class GlobalManager {
	constructor() {
		this.fcEntry = document.getElementById("FCentry");
		this.pageEntry = document.getElementById("PageEntry");
	}
}
const G = new GlobalManager();

G.fcEntry.addEventListener("keydown", (evt) => {
	if (evt.key === "Enter" && !evt.isComposing) {
		evt.preventDefault();
		fcSearch();
		G.fcEntry.focus();
	} else if (evt.key == "Escape") {
		G.fcEntry.value = "";
	}
});
G.fcEntry.addEventListener("focus", (evt) => {
	G.fcEntry.select();
});

G.pageEntry.addEventListener("keydown", (evt) => {
	if (evt.key === "Enter" && !evt.isComposing) {
		evt.preventDefault();
		directOpen();
		G.pageEntry.focus();
	} else if (evt.key == "Escape") {
		G.pageEntry.value = "";
	}
});
G.pageEntry.addEventListener("focus", (evt) => {
	G.pageEntry.select();
});

function zenToHan(entry) {
	return entry.replace(/[０-９]/g, (ch) => {
		const diff = ch.codePointAt(0) - '０'.codePointAt(0);
		return String.fromCodePoint('0'.codePointAt(0) + diff);
	});
}

function fcSearch() {
	let entry = G.fcEntry.value;
	if (entry.match(/[^0-9０-９]/)) {
		alert("Enter numerical value.");
		return;
	}
	entry = zenToHan(entry);
	G.fcEntry.value = entry;

	let idx = FourCornerData.length - 1;
	while (FourCornerData[idx] > entry) {
		idx--;
	}
	openWindow(FCurl + (idx + FourCornerData[0]), "FCresult");
}

function directOpen() {
	let entry = G.pageEntry.value;
	if (entry.match(/[^0-9０-９]/)) {
		alert("Enter numerical value.");
		return;
	}
	entry = zenToHan(entry);
	G.pageEntry.value = entry;
	openWindow(DaijitenURL + (Math.floor(entry/2) + PageOffset), "大字典")
}

function openWindow(url, title) {
	window.open(url, title);
}

G.fcEntry.focus();
</script>

	</body>
</html>
